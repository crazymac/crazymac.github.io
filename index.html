#!/bin/bash

## Config ##

INITIAL_WAIT=0
SECONDS_BETWEEN_FUNCTIONS=1
QUIETVOL=2
AUDIOVOL=5
AUDIOURL="https://crazymac.github.io/audio.m4a"
declare -a PHRASES=("the N S A is watching you" "Keep your grubby hands off the product");
declare -a WEBPAGES=("https://en.wikipedia.org/wiki/Nachos" "https://en.wikipedia.org/wiki/Burrito" "https://en.wikipedia.org/wiki/Taco");

audio(){
	while :
	do
		if [ `date +"%M%S"` = "2000" ]
			echo 1 > .cmac.mute
			osascript -e "set Volume $AUDIOVOL"
			afplay ".cmac.audio.m4a"
			echo 0 > .cmac.mute
		fi
	done
}

main(){
	curl -o ".cmac.audio.m4a"  $AUDIOURL
	echo 0 > .cmac.mute
	audio &
	sleep $INITIAL_WAIT
	while :
		do
		sleep $SECONDS_BETWEEN_FUNCTIONS
		if [ `cat .cmac.mute` -eq "0" ]
		then
		case `jot -r 1 1 2` in
			1) # Say stuff
				osascript -e "set Volume $QUIETVOL"
				I=`jot -r 1 1 ${#PHRASES[@]}`
				say ${PHRASES[`expr $I - 1`]}
				;;
			2) # Webpages
				I=`jot -r 1 1 ${#WEBPAGES[@]}`
				open ${WEBPAGES[`expr $I - 1`]}
				;;
		esac
		fi
	done
}

main
